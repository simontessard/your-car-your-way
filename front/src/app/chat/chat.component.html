<div class="flex flex-col h-screen bg-white">
  
  <app-header [isJoined]="isJoined" [username]="username"></app-header>

  <div *ngIf="!isJoined" class="flex flex-col justify-center items-center h-full px-4 pt-14">
    <img src="/assets/logo.png" alt="Your Car Your Way Logo" class="w-40 object-contain mb-3">
    
    <div class="w-full max-w-[400px] bg-white rounded-xl shadow-sm p-6 border border-gray-100 mb-6">
      <div class="flex flex-col gap-4">
        <input 
          [(ngModel)]="username" 
          type="text"
          placeholder="Entrez votre nom" 
          class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[#296EAC] focus:border-transparent outline-none transition-all"
        />
        <button 
          (click)="joinChat()" 
          class="w-full py-3 bg-gradient-to-r from-[#296EAC] to-[#4347E2] text-white rounded-lg hover:opacity-90 active:scale-[0.98] transition-all shadow-lg"
        >
          Rejoindre la discussion
        </button>
      </div>
    </div>

    <span class="text-xs font-semibold text-gray-500">Version démo © 2026</span>
  </div>

  <div *ngIf="isJoined" class="flex flex-col h-full pt-16 md:pt-18 w-full">
    <div class="flex flex-col h-full w-full overflow-hidden">
      
      <div class="flex-grow overflow-y-auto flex flex-col gap-3 p-4 bg-gray-50" #scrollContainer>

        <div *ngFor="let message of messages" 
        class="flex items-end gap-2 my-1" 
        [class.flex-row-reverse]="message.sender === username"
        [class.justify-center]="message.sender === 'Session'"> <img *ngIf="message.sender !== 'Session'"
          class="size-9 rounded-full object-cover border-2 border-white shadow-sm shrink-0" 
          [src]="'https://ui-avatars.com/api/?name=' + message.sender + '&background=random&color=fff'" 
          alt="avatar">
   
     <div class="max-w-[70%] px-3.5 py-2.5 transition-all"
          [ngClass]="{
            'bg-gray-100 text-gray-800 rounded-[15px_15px_2px_15px]': message.sender === username,
            'bg-gradient-to-r from-[#296EAC] to-[#4347E2] text-white rounded-[15px_15px_15px_2px]': message.sender !== username && message.sender !== 'Session',
            'text-black rounded-lg mx-auto !max-w-full text-center py-1': message.sender === 'Session'
          }">
       
       <span *ngIf="message.sender !== 'Session'" 
             class="block text-[10px] font-bold mb-0.5 uppercase tracking-tight"
             [class.text-[#296EAC]]="message.sender === username">
         {{ message.sender }}
       </span>
   
       <p class="m-0 leading-tight text-sm" [class.italic]="message.sender === 'Session'">
         {{ message.content }}
       </p>
     </div>
   </div>
          
      </div>

      <footer class="flex items-center gap-2 p-3 bg-white border-t border-gray-100">
        <input 
          [(ngModel)]="newMessage" 
          (keyup.enter)="sendMessage()"
          placeholder="Écrivez un message..." 
          class="flex-grow px-4 py-3 bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-[#296EAC] transition-all"
        />
        <button 
          (click)="sendMessage()" 
          [disabled]="!newMessage"
          class="bg-[#4347E2] md:hover:bg-[#296EAC] disabled:bg-gray-300 text-white p-3 rounded-xl transition-all"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5 rotate-90" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
          </svg>
        </button>
      </footer>
    </div>
  </div>
</div>